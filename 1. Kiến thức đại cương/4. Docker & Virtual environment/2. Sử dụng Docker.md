
Một dự án Docker thực tế là 1 folder trong host machine.
Trong bài viết, thư mục đó sẽ có tên là `my_project`.

# Xây dựng Dockerfile

Dockerfile bao gồm các định nghĩa, hướng dẫn cho Docker để xây dựng các Image. Dockerfile không có phần mở rộng.

**Một số cú pháp của `Dockerfile`**:

**`FROM ...`**:
- Tên image (*base-image*) mà image hiện tại dựa trên.
- [Docker hub](https://hub.docker.com/): Các image được chia sẻ miễn phí bởi cộng đồng.

**`WORKDIR path`**:
- Địa chỉ folder chính bên trong image.
- Bên trong image cũng có cây thư mục tương tự 1 project thường.

**`ENV PATH='path'`**:
- Thêm biến môi trường.

**`COPY source_file dest_file`**:
- Địa chỉ các file trong host machine.
- Docker sẽ copy các file đó vào image.

**`EXPOSE`**:
- Chỉ định số port của image.
- Số port này cần được mapping đến 1 port của host machine. Khi truy cập vào port của host thì các script bên trong container tương ứng sẽ được thực thi.

**`RUN`**:
- Các bash-script sẽ được thực thi khi image được build.

**`ENTRYPOINT ['cmd', ...]`**:
- Các bash-script sẽ được thực thi khi container được chạy.

**`CMD ['cmd', ...]`**:
- Các tham số của `ENTRYPOINT`.
- Các bash-script sẽ được thực thi khi container được chạy (*nếu không có `ENTRYPOINT`*).

VD: `ENTRYPOINT` và `CMD`:
```Dockerfile
ENTRYPOINT ["uvicorn", "main:app"]
CMD ["--host", "0.0.0.0", "--port", "8000"]
```

Sẽ tương đương với:
```sh
uvicorn main:app --host '0.0.0.0' --port 8000
```

VD: `Dockerfile`:
```dockerfile
# Start with slim Python 3.13 image
FROM python:3.13.10-slim

# Copy uv from official uv image
COPY --from=ghcr.io/astral-sh/uv:latest /uv /bin/

# Set working directory
WORKDIR /app

# Add venv to PATH so we can use installed packages
ENV PATH="/app/.venv/bin:$PATH"

# Copy dependency files first
COPY "pyproject.toml" "uv.lock" ".python-version" ./

# Install dependencies from lock file
RUN uv sync --locked

# Copy application code
COPY pipeline.py pipeline.py

# Set entry point
ENTRYPOINT ["python", "pipeline.py"]
```

# Xây dựng image

```sh
docker build -t my_project .
```
- `-t`: Tên của Docker project.
- `.`: Quét tìm Dockerfile bên trong project.

# Chạy container

```sh
docker run my_project
```

Hoặc sử dụng *GUI* để run container.

Docker Destop sẽ yêu cầu một số thuộc tính như `Ports`: Số port của máy thực. Số port này sẽ được mapping vào port của container. Nếu ứng dụng không cần port thì không cần khai báo.

**Chạy container và chuyển đến bash của container đó (*Interactive mode*)**:
```sh
docker run -it my_project bash
```
Tại bash, bạn có thể thao tác với các file bên trong container.

# Volume

**Volume**:
- Là cơ chế **liên kết các file trong container với các file của host machine**.
- Khi container bị khởi động lại, các file vẫn giữ nguyên *vì chúng vốn ở host machine*.

Có 2 loại volume:
- **Named volume**: Bạn chỉ đặt tên cho volume chứ không chỉ rõ đường dẫn -> Docker sẽ tự quản lý volume đó (*Vào Docker destop để xem*).
- **Bind moute**: Gắn trực tiếp 1 folder ở host machine (`./`) làm volume.

# Quản lý Image và container

|                                   | Image                   | Container                | Volume                   | Network                   |
| --------------------------------- | ----------------------- | ------------------------ | ------------------------ | ------------------------- |
| **Xem danh sách**                 | `docker images`         | `docker ps -a`           | `docker volume ls`       | `docker network ls`       |
| **Xóa**                           | `docker rmi my_img`     | `docker rm my_ctn`       | `docker volume rm my_vl` | `docker network rm my_nw` |
| **Xóa hết các object đang ngừng** | `docker image prune -a` | `docker container prune` | `docker volume prune`    | `docker network prune`    |
