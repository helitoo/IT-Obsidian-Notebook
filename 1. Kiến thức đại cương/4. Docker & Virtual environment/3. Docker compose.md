
Docker compose là công cụ giúp xây dựng nhiều container cùng lúc.

**Ưu điểm**:
- Có thể thực thi nhiều container chỉ với một câu lệnh.
- Tự động khởi tạo network để các container có thể giao tiếp với nhau.
- Dễ dàng cấu hình.

Docker compose được cấu hình trong file `.yml`.

# Một số trường của `.yml`

| Trường     | Ý nghĩa                        |
| ---------- | ------------------------------ |
| `version`  | Số phiên bản.                  |
| `services` | Tên các container.             |
| `volumes`  | Tên các volume.                |
| `networks` | Cấu hình network cho ứng dụng. |

Bên trong trường `services` có một số trường con sau:

| Trường       | Ý nghĩa                                                                                                                         |
| ------------ | ------------------------------------------------------------------------------------------------------------------------------- |
| `image`      | Tên image sẽ được dùng để build container.                                                                                      |
| `port`       | Có dạng `a:b`, với:<br>- `a` là port của máy thật.<br>- `b` là port của container.                                              |
| `volumes`    | Có dạng `a:b`, với:<br>- `a` là đường dẫn của máy thật, là tên volumns đã khai báo ở trên.<br>- `b` là đường dẫn của container. |
| `enviroment` | Các biến môi trường được truyền vào Docker.                                                                                     |
| `depends_on` | Chọn các service được thực thi trước khi thực thi service này.                                                                  |
| `build`      | Chỉ ra vị trị đường dẫn đặt `Dockerfile`                                                                                        |

VD:
Cấu hình Docker compose cho PostgreSQL và pgAdmin (*Xem thêm tại Bài tập 1, 2, 3*).
Lưu ý rằng Docker compose đã tự khởi tạo network, nên ta không cần cấu hình `pg-network` nữa.

`docker-compose.yml`
```yaml
services:
  # PostgreSQL container
  pgdatabase:
    image: postgres:15
    environment:
      POSTGRES_USER: "root"
      POSTGRES_PASSWORD: "root"
      POSTGRES_DB: "ny_taxi"
    volumes:
      - "ny_taxi_postgres_data:/var/lib/postgresql"
    ports:
      - "5432:5432"

  # pgAdmin container
  pgadmin:
    image: dpage/pgadmin4
    environment:
      PGADMIN_DEFAULT_EMAIL: "admin@admin.com"
      PGADMIN_DEFAULT_PASSWORD: "root"
    volumes:
      - "pgadmin_data:/var/lib/pgadmin"
    ports:
      - "8085:80"

volumes:
  ny_taxi_postgres_data:
  pgadmin_data:
```

# Các câu lệnh thường dùng

Build các images (nếu cần tạo):
```sh
docker-compose build
```

Chạy các services bên trong background:
```sh
docker-compose up -d
```

Chạy container và build image
```sh
docker-compose up --build -d
```

Dừng và loại bỏ các container, network, image và volume:
```sh
docker-compose down
```
