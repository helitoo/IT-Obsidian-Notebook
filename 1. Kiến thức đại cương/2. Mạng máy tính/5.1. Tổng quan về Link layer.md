
**[[1. Tổng quan về mạng máy tính#Phân tầng mạng|Link layer]]**: Chuyển tiếp dữ liệu giữa các phần tử lân cận trong mạng (Ethernet, Wifi,...).

Trong quá trình truyền dữ liệu, gói tin ở tầng network phải đi qua nhiều [[1. Tổng quan về mạng máy tính#Mạng truy cập (Access network)|liên kết]] khác nhau, đảm nhận ở tầng liên kết khác nhau.

Tầng liên kết được triển khai trong **card mạng (Network interface card - NIC)** hoặc trên các **chip**.

# Các dịch vụ của Link layer

1. **Framing và truy cập kênh**:
	- Đóng gói gói tin, thêm header và trailer tạo thành **frame**.
	- Lựa chọn các host được quyền gửi gói tin (**phân quyền truy cập kênh truyền**).
	- Dùng **địa chỉ MAC** để định danh vật lý các host.

2. **Truyền tin cậy giữa các nút liền kề** (*khác với truyền tin cậy ở tầng transport là xử lý lỗi trên toàn hành trình truyền tin*):
    - Đảm bảo dữ liệu từ một nút gửi sang nút liền kề đến nơi chính xác.
    - Trên các liên kết có dây có tỷ lệ lỗi thấp -> Ít áp dụng.
    - Trên các liên kết không dây có tỷ lệ lỗi cao -> Thường áp dụng.

- **Kiểm soát lưu lượng (flow control)**:
    - Giúp đồng bộ tốc độ giữa **nút gửi** và **nút nhận liền kề** để tránh tình trạng nhận không kịp, gây mất dữ liệu.

- **Phát hiện lỗi (error detection)**:
    - Tầng liên kết sẽ thêm **bit kiểm tra lỗi (CRC, checksum, parity, ...)** để bên nhận kiểm tra.
    - Nếu phát hiện lỗi, dữ liệu sẽ bị bỏ hoặc yêu cầu truyền lại.

- **Sửa lỗi (error correction)**:
    - Bên nhận có thể tự động sửa một số lỗi bit nhỏ mà không cần yêu cầu truyền lại (Forward Error Correction).

- **Truyền bán song công (half-duplex) và song công (full-duplex)**:
    - **Half-duplex**: 2 nút đều có thể truyền, nhưng **không đồng thời** (VD: bộ đàm).
    - **Full-duplex**: 2 nút có thể truyền và nhận **đồng thời** (VD: Ethernet hiện đại).

# Phát hiện lỗi và sửa lỗi

**Nguyên lý chung**:
- **EDC (Error detection and correction)**: Là các bit phát hiện và sửa lỗi.
- **Bên gửi**: Gắn EDC vào gói tin.
- **Bên nhận**: Nhận gói kèm EDC và tự tính EDC, nếu EDC bên gửi giống bên nhận thì không có lỗi.

>[!important]
>- Không phải lỗi nào cũng có thể phát hiện và sửa được.
>- EDC càng dài thì khả năng phát hiện lỗi và sửa lỗi càng tốt.

**Các phương pháp phát hiện lỗi và sửa lỗi**:

- **Checksum**.

- **Kiểm tra chẵn - lẻ (Parity checking)**: Nếu có số lượng **lẻ** bit `1` trong gói tin thì EDC = `1`, ngược lại là `0`. Có 2 phương pháp:
	- **1 chiều**: Dùng 1 EDC.
	- **2 chiều**: Mỗi cột và hàng được đánh dấu bằng một EDC.

- **Cyclic Redundacy Check (CRC)**:
	- **Bên gửi**:
		- Gọi $G$ là dãy mẫu bit (bộ tạo / đa thức sinh), là một số bit được quy ước từ trước.
		- Tìm mã CRC $R$:
			1. Thêm $|R|-1$ bit `0` vào cuối.
			2. Lấy phần dư của $\dfrac{D}{G}$.
			3. Thêm phần dư này vào cuối $D$.
	- **Bên nhận**: Nhận gói tin $D$, nếu phần dư của $\dfrac{D}{G}=0$ thì $D$ không lỗi.
	- **Chú ý**: Phép chia ở đây nghĩa là **thực hiện tuần tự phép $\text{XOR}$ từ trái sang phải**.

# Các giao thức đa truy cập (broadcast)

>[!Note] Bài học cũ từ chương Nhập môn
>- **Switch**: Kết nối các *thiết bị mạng*.
>- **Router**: Kết nối các *mạng*.
>- **Bridge**: Kết nối các *mạng LAN nhỏ*, ít dùng.
>- **Modem**: Kết nối *LAN với ISP*.

## Vùng va chạm (Collision domain)

Là vùng mạng mà tại đó, 2 nút gửi dữ liệu cùng lúc đụng độ -> Gắn liền với *giao thức truy cập ngẫu nhiên*.

-> **Mỗi liên kết giữa 2 node là 1 vùng va chạm**.

>[!note]
>Các thiết bị *router / bridge / switch* đều có thể **thay đổi số lượng vùng va chạm**.

## Vùng quảng bá (Broadcast domain)

Là vùng mạng mà địa chỉ tại đó là địa chỉ broadcast.

-> **Mỗi mạng có 1 vùng broadcast**.
-> Mỗi **cloud** cũng có 1 vùng broadcast.

## Giao thức đa truy cập

**Giao thức đa truy cập**: Là thuật toán phân phối nhằm xác định cách thức để các nút chia sẻ kênh truyền, tức là xác định nút nào có thể truyền.

**Tiêu chuẩn của giao thức đa truy cập**:
- **Phi tập trung**: Không có nút nào quản lý việc truyền tin của các nút, không có đồng bộ hóa hay khe thời gian.
- **Hiệu năng cao**.

| Phân hoạch kênh (Division multiple access, DMA)                                                                                                                                                                                                        | Truy cập ngẫu nhiên                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | Truyền luân phiên                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Chia kênh truyền thành các kênh nhỏ hơn**, phân bố cách kênh nhỏ này cho các nút sử dụng độc quyền.                                                                                                                                                  | **Cho phép các nút truyền với tốc độ tối đa** và có thể đụng độ khi truyền.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Điều khiển **các nút luân phiên truyền tin**.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| - Gây lãng phí nếu có khoảng thời gian / dãy tần trống, không được sử dụng.<br>- Hiệu quả khi có *nhiều nút đồng thời (tải cao)*.                                                                                                                      | Hiệu quả khi có *ít nút đồng thời (tải thấp)*.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | - Là cải tiến từ phân hoạch và truy cập ngẫu nhiên.<br>- Vẫn còn điểm lỗi chứ chưa toàn diện.                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| ---<br>**TDMA (Time DMA)**: Các nút được truyền tin lần lượt theo vòng trong một khoảng *thời gian* cố định.<br><br>--- <br>**FDMA (Frequency DMA)**: Kênh truyền được chia thành nhiều *dải tần số* riêng biệt, mỗi nút được quyền sử dụng 1 dài tần. | ---<br>**Slotted ALOHA**:<br>- Các nút được gửi gói tin có kích thước như nhau sau một *khoảng thời gian nhất định (time slot)*.<br>- Nếu có xung đột, các gói tin đó sẽ phải được *gửi lại* trong các time slot tiếp theo với xác suất $p$ -> Tốn slot.<br>- Trong trường hợp lý tưởng nhất, slotted ALOHA chỉ tận dụng được *37%* thời gian.<br><br>---<br>**Pure ALOHA**:<br>- Vẫn là ALOHA nhưng gói tin không cần đợi đến time slot mới được gửi mà *có thể gửi đi bất kỳ lúc nào*.<br>- Hiệu quả *kém hơn Slotted ALOHA*.<br><br>---<br>**CSMA**:<br>- Theo dõi kênh truyền, **nếu kênh trống thì mới cho phép các nút truyền**, không thì các nút phải đợi.<br>- CSMA **không có cơ chế giải quyết xung đột**, các nút không biết có xung đột -> vẫn truyền -> giảm hiệu năng.<br><br>---<br>**CSMA/CD (Clollide detection)**:<br>- Là cải tiến của CSMA với kỹ thuật **phát hiện xung đột**.<br>- Trong Ethernet, càng xảy ra xung đột thì các gói tin có khả năng **đợi dài hơn (Binary exponential backoff)**.<br> | ---<br>**Kiểm soát vòng**:<br>- Có một nút *điều khiển tuần tự các nút khác gửi gói*.<br>-> Thường dùng với *các thiết bị câm*. Các thiết bị này sẽ không gửi dữ liệu trừ khi nhận được lệnh của nút điều khiển.<br>-> *Điểm lỗi ở nút điều khiển*, nếu nút này có sự cố thì các nút khác không truyền dữ liệu được.<br><br>---<br>**Chuyển token**:<br>- Chỉ có nút đang giữ *token* thì mới được truyền dữ liệu.<br>- Teken được chuyền luân phiên giữa các nút.<br>-> *Điểm lỗi ở token*, nếu không có token thì các nút không truyền dữ liệu được.<br> |













