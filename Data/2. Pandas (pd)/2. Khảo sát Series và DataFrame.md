
```insta-toc
---
title:
  name: Mục lục
  level: 1
  center: false
exclude: ""
style:
  listType: number
omit: []
levels:
  min: 1
  max: 6
---

# Mục lục

1. Kiểu dữ liệu
2. Truy xuất
    1. Boolean indexing
    2. SQL-like query
3. Duyệt DataFrame
    1. Duyệt theo record
    2. Duyệt qua field
4. Tìm kiếm giá trị
```

# Kiểu dữ liệu

Kiểu dữ liệu trong Pandas được gọi là `dtype`.

Có một số phương thức đặc biệt như sau:

| Phương thức                            | Mô tả                                                                                                |
| -------------------------------------- | ---------------------------------------------------------------------------------------------------- |
| `df.dtypes`                            | Trả về kiểu của từng cột trong DataFrame.                                                            |
| `s.dtype`                              | Trả về kiểu của Series.                                                                              |
| `dtObj.index.dtype`                    | Trả về kiểu của index.                                                                               |
| `c.astype('type')`                     | Ép kiểu của cột `c`.                                                                                 |
| `pd.isnull(c)`                         | Dùng trong boolean indexing, nếu giá trị của cột `c` là `NaN`.<br>Tương tự với `pd.notnull(c)`.      |
| `dtobj.replace(a, b, inplace=False)`   | Thay thế các cell có giá trị `a` thành `b`.                                                          |
| `dtobj.fillna(v, inplace=False)`       | Thay thế các cell có giá trị `NaN` thành `v`.                                                        |
| `dtobj.dropna(inplace=False)`          | Loại bỏ các cell / record có giá trị `NaN`.                                                          |
| `dtobj.drop_duplicates(inplace=False)` | Loại bỏ các cell / record bị trùng. Chỉ giữ lại 1 cell / record trong số các cell / record bị trùng. |

Tham số `inplace=False` thể hiện rằng hàm sẽ sao chép lại `dtobj`, thực hiện làm sạch rồi trả về kết quả (tham trị).

# Truy xuất

|                      | **Series**      | **Series**              | **DataFrame**              | **DataFrame**            |
| -------------------- | --------------- | ----------------------- | -------------------------- | ------------------------ |
|                      | Trả về **cell** | Trả về **Series**       | Trả về **Cột / DataFrame** | Trả về **cell**          |
| **Integer-location** | `s.iloc[i]`     | `s.iloc[[i1, i2, ...]]` | `df.iloc[rIdxs]`           | `df.iloc[rIdx, cIdx]`    |
| **Label-location**   | `s.loc[label]`  | `s.loc[[l1, l2, ...]]`  | `df.loc[rLabels]`          | `df.loc[rLabel, cLabel]` |
| **Boolean indexing** | `s[cond]`       | `s[cond]`               | `df[cond]`                 | `df.loc[cond, colLabel]` |

>[!important]
>- Series cho phép **slicing**.
>- Cột index có label là `index`.
>- Index của `iloc` là 0-based, còn `loc` là 1-based.

Đối với cú pháp **truy xuất nhiều cell / Series**:
- Bạn chỉ cần liệt kê các index/label trong 1 list là Pandas sẽ tự hiểu là bạn muốn lấy các cell/Series tại index/label đó.
- Đối với *Series trả về Series*, Pandas còn hỗ trợ `s.iloc[s:e]` tương đương với `s.iloc[range(s, e)]`, tương tự với các phương thức khác.

## Boolean indexing

Toán tử `[]` sẽ trả về 1 cell/series thỏa điều kiện `cond` (*Boolean expression*). Trong đó:
- `cond` là điều kiện logic có toán hạng là label các cột. Đối với DataFrame, toán hạng là `df[...]`.
- Các phép logic: `>`, `<`, `=`,... , `.notnull()`, `|` (or), `&` (and).

Nguyên lý như sau:
1. **Xây dựng mask**: Duyệt từng hàng của DataFrame / từng phần tử của Series. Nếu phần tử đó thỏa boolean expression thì trả về `True`, không thì `False`.
2. **Lọc**: Duyệt DataFrame / Series lần 2, nếu phần tử đó tương ứng với `True` trong mask thì giữ lại, không thì bỏ ra.

![](boolean-indexing.png)

>[!tip]
>Thường kết hợp boolean indexing với **`.sum()` để đếm số lượng** (thay vì `.count()`).

## SQL-like query

Ngoài cách truy vấn sơ khai sử dụng boolean indexing, bạn còn có thể thực các truy vấn như SQL như sau:

```python
df.query("sqlStm")
```
VD:
- `"age > 25 and gender == 'Male'"`.
- `"score >= 80 or passed == True"`.
- `` `full name` == `Nguyễn Văn A` ``: Dùng \` do tên field có dấu cách.

# Duyệt DataFrame

## Duyệt theo record

*Cách 1*: Duyệt bằng namedtuple:
```python
df.itertuples()
```
Trả về iterable của các namedtuple có dạng `Pandas(Index=index, field1=..., field2=..., ...)`. Có nghĩa là, bạn sẽ truy xuất các phần tử của `itertuples` theo kiểu `.fieldName`.

*Cách 2*: Duyệt bằng Serie:
```python
df.iterrows()
```
Trả về một iterable của các tuple có dạng `(index, data)`. Với:
- `index`: Chỉ số index của `data`.
- `data`: Là một Serie tương ứng với từng hàng của DataFrame.

## Duyệt qua field

```python
df.items()
```
Trả về iterable của các tuple có dạng `(fieldName, data)`. Với:
- `fieldName`: Tên của field.
- `data`: Là một Serie chứa dữ liệu của field `fieldName`.

# Tìm kiếm giá trị

```python
dtobj.isin(vals)
```
`vals` nhận 1 giá trị hoặc 1 mảng. Hàm trả về `True` nếu giá trị này / các giá trị trong mảng này (đều) thuộc `dtobj`.

```python
arr.any()
```
Trả về `True` nếu có cell trong `arr` là `True`.

```python
arr.all()
```
Trả về `True` nếu toàn bộ cell trong `arr` là `True`.
