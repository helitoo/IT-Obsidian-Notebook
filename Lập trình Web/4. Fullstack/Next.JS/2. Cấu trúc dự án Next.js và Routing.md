
```insta-toc
---
title:
  name: Mục lục
  level: 1
  center: false
exclude: ""
style:
  listType: number
omit: []
levels:
  min: 1
  max: 6
---

# Mục lục

1. Routing file
2. Routing path
3. App navigation
    1. Link component
    2. useRouter()
    3. redirect() và permanentRedirect()
```

**Tài liệu tham khảo**:
- [Next.js | Linking and Navigating](https://nextjs.org/docs/app/getting-started/linking-and-navigating).
- [Nextjs | How to handle redirects in Next.js](https://nextjs.org/docs/app/guides/redirecting).

>[!note]
>Trong Next.js hỗ trợ 2 loại routing là **App routing** (thực hiện bên trong `app/`) và **Page routing** (thực hiện bên trong `pages/`). Trong bài viết này ta chỉ tìm hiểu *App routing* vì nó hiện đại và đang được phát triển.

# Routing file

Có một số loại routing file sau:
- **`layout.tsx`**: Là trang chứa component chung nhất, chẳng hạn như header, footer, navigation,...
- `page.tsx`: Chứa nội dung chính.
- `loading.tsx`, `not-found.tsx`, `error.tsx`, `global-error.tsx`, ...

**Wrapper**: Là các folder bao bọc lấy các trang cụ thể, tên của mỗi folder tạo thành routes.

>[!note]
>Folder chứa các file có tên đặc biệt như trên thì mới được tính vào routes.

# Routing path

Có 3 loại:

---
**Nested routes**: Tên của các folder tạo thành routes.

| Path                        | URL pattern     |
| --------------------------- | --------------- |
| `app/layout.tsx`            | ` `             |
| `app/blog/layout.tsx`       | ` `             |
| `app/page.tsx`              | `/`             |
| `app/blog/page.tsx`         | `/blog`         |
| `app/blog/authors/page.tsx` | `/blog/authors` |

---
**Private folder**: Tên của các folder này bị ẩn trong route, ký hiệu là `(x)`.

| Path                            | URL pattern |
| ------------------------------- | ----------- |
| `app/(marketing)/page.tsx`      | `/`         |
| `app/(shop)/cart/page.tsx`      | `/cart`     |
| `app/blog/_components/Post.tsx` | ` `         |
| `app/blog/_lib/data.ts`         | ` `         |

---
**Dynamic routes**: Là tham số hóa các thành phần của route.
1. Dùng `[x]` cho 1 tham số.
2. Dùng `[[x]]` cho nhiều tham số.
3. Dùng toán tử `...x` để ngụ ý "optional".

VD:

| Path                            | URL pattern                                                                |
| ------------------------------- | -------------------------------------------------------------------------- |
| `app/blog/[slug]/page.tsx`      | `/blog/my-first-post`                                                      |
| `app/shop/[...slug]/page.tsx`   | `/shop/clothing`,<br>`/shop/clothing/shirts`                               |
| `app/docs/[[...slug]]/page.tsx` | `/docs`,<br>`/docs/layouts-and-pages`,<br>`/docs/api-reference/use-router` |

# App navigation

Có ít nhất 6 cách để kiểm soát chuyển hướng trong Nextjs:

| Module            | Công cụ                   | Nguyên lý                                                                                         | Dùng ở đâu?                                                                    |
| ----------------- | ------------------------- | ------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------ |
| `next/link`       | `<Link>`                  | Là một component, khi được click sẽ điều hướng sang trang mới.                                    | Thanh Navbar (Điều hướng nội bộ).                                              |
| `next/navigation` | `useRouter()`             | Là một hook, được gắn với các handler.                                                            | Client component.                                                              |
| `next/navigation` | `redirect()`              | Là một hàm luôn trả về mã lỗi `303` (Server actions) / `307` để browser điều hướng đến trang mới. | Client component / Server component, nhưng không được nằm trong event handler. |
| `next/navigation` | `permanentRedirect()`     | Giống `redirect()` nhưng trả về `308`.                                                            | Client component / Server component, nhưng không được nằm trong event handler. |
| `next.config.js`  | `redirects()`             | Giống `permanentRedirect()` nhưng áp dụng cho toàn website thay vì từng component.                | Config.                                                                        |
| `next/server`     | `NextResponse.redirect()` | Ở middleware                                                                                      | Auth.                                                                          |

>[!tip] Mã lỗi `303`, `307`, `308` có ý nghĩa gì?
>- `303 SEE OTHER`: Request ban đầu đã được xử lý thành công, nhưng server yêu cầu client truy cập vào một URL khác để xem kết quả. HTTP method khi redirect có thể bị thay đổi.
>- `307 TEMPORARY REDIRECT`: Tạm redirect sang một trang mới, sau đó có thể sẽ quay về trang cũ.
>- `308 PERNAMENT`: Redirect vĩnh viễn sang trang mới, trang cũ có thể đã lỗi thời nên đã bị bỏ qua.

## Link component

Một số thuộc tính của `<Link>`:

| Thuộc tính   | Giá trị mặc định  | Ý nghĩa                                                                                                                                                                  |
| ------------ | ----------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `href`       | --                | (**Requires**) Route path.                                                                                                                                               |
| `prefetch`   | `"auto"` / `null` | - Nếu `null`: Hành vi prefetch tuân theo mặc định của Nextjs.<br>- Nếu `false`: Chặn prefetching đối với route này.<br>- Nếu `true`: Luôn prefetching đối với route này. |
| `replace`    | `false`           | Nếu `true`: Lưu trang web mới vào lịch sử duyệt web.                                                                                                                     |
| `scroll`     | `true`            | Nếu `true`: Lưu lại vị trí cuộn.                                                                                                                                         |
| `onNavigate` | `() => {}`        | Callback function được kích hoạt khi client được điều hướng.                                                                                                             |

Ngoài ra, các thuộc tính của `<a>` cũng có thể áp dụng lên `<Link>`.

VD:
```tsx
import Link from 'next/link'
 
export default function Page() {
  return <Link href="/dashboard">Dashboard</Link>
}
```

## `useRouter()`

**Các bước sử dụng**:
1. Tạo instance của `useRouter()`.
2. Instance này có một số phương thức sau:
	- `.push(href: string, { scroll: boolean }?)`: Điều hướng đến trang mới và đưa vào lịch sử duyệt web.
	- `.replace(href: string, { scroll: boolean }?)`: Điều hướng đến trang mới nhưng không đưa vào lịch sử duyệt web.
	- `.refresh()`: Tải lại trang. Lưu ý các trạng thái VD: *vị trí scroll,...* sẽ không bị mất.
	- `.prefetch(href: string, options?: { onInvalidate?: () => void })`: Prefetch trang mới.
	- `.back()`: Điều hướng về trang liền trước trong lịch sử duyệt web.
	- `.forward()`: Điều hướng về trang liền sau trong lịch sử duyệt web.

VD:
```tsx
'use client'
 
import { useRouter } from 'next/navigation'
 
export default function Page() {
  const router = useRouter()
 
  return (
    <button type="button" onClick={() => router.push('/dashboard')}>
      Dashboard
    </button>
  )
}
```

## `redirect()` và `permanentRedirect()`

**Cú pháp**:
```tsx
redirect(path, type?)
permanentRedirect(path, type?)
```

Trong đó, `type` có 2 loại đối số:
- `'replace'`: Điều hướng đến trang mới và đưa vào lịch sử duyệt web.
- `push`: Điều hướng đến trang mới nhưng không đưa vào lịch sử duyệt web.

>[!note]
>`redirect()` / `permanentRedirect()` luôn trả về mã lỗi `303` / `307` / `308` để điều hướng, nên **không được đưa vào `try/catch`**.






