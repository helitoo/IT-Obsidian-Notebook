
```insta-toc
---
title:
  name: Mục lục
  level: 1
  center: false
exclude: ""
style:
  listType: number
omit: []
levels:
  min: 1
  max: 6
---

# Mục lục

1. Bài toán đặt ra
2. Context API
    1. Giới thiệu
    2. Cách triển khai
3. Zustand
    1. Giới thiệu
    2. Cách triển khai
```

# Bài toán đặt ra

**Vấn đề global state**: Nếu ứng dụng chỉ có một vài state đơn giản (bao gồm biến và hàm), thì bạn có thể cài đặt `useState` và các hook cần thiết ngay tại function component đó. Thế nhưng, khi ứng dụng càng lớn thì:
- Nhu cầu trao đổi state giữa các component càng cao, quan hệ logic giữa các state ngày càng phức tạp.
- Các state buộc phải prop drilling qua nhiều component, khiến độ khó code trở nên phức tạp.

>[!important]
>State management là quản lý các state. Globle state management đặt ra các **kho chứa** các tính toàn cục. Các component có thể dùng trực tiếp các state trong kho chứa mà không cần prop drilling.

# Context API

## Giới thiệu

 Context API là 1 global state management được hỗ trợ sẵn ở React. Ở đây, kho chứa được gọi là **context**.

Mỗi context bao gồm 2 thuộc tính:
- `urContext.Provider`: Là component dùng để bao bọc các component được phép dùng các biến và hàm trong context.
- `urContext.Consumer`: Là component được `.Provider` bao bọc.

Giá trị của context là các biến và hàm của nó.

Ban đầu, mỗi context đều có một giá trị mặc định là `defaultValue`. Giá trị này được sử bằng thuộc tính `value` của `.Provider`.

## Cách triển khai

**Khai báo context**:
1. Tạo context bằng `createContext(urDefaultValue)`.
2. Tạo provider chứa các biến và hàm cần thiết. Bản chất provider là một component function.
3. Dùng `urContext.Provider` để bao bọc các component cần thiết.

**Sử dụng context**:
1. Lấy context ra thông qua `useContext(urContext)`.
2. Lấy ra các biến và hàm cần dùng qua context đó.

>[!note]
>Cách triển khai Context API khá rườm rà và chỉ phù hợp với các ứng dụng có quy mô nhỏ.

VD:

Tôi cần tạo một context nhằm hỗ trợ việc gọi, hủy màn hình loading, gọi là `LoadingContext`.

Khai báo context:
`LoadingContext.tsx`
```tsx
import { createContext, useContext, useState, type ReactNode } from "react";

type LoadingContextType = {
  loading: boolean;
  showLoading: () => void;
  hideLoading: () => void;
};

const LoadingContext = createContext<LoadingContextType | undefined>(undefined);

export const LoadingProvider = ({ children }: { children: ReactNode }) => {
  const [loading, setLoading] = useState(false);

  const showLoading = () => setLoading(true);
  const hideLoading = () => setLoading(false);

  return (
    <LoadingContext.Provider value={{ loading, showLoading, hideLoading }}>
      {children}
    </LoadingContext.Provider>
  );
};
```

Đồng thời, tôi còn cung cấp hàm `useLoading()` để thuận tiện trong việc lấy context ra dùng:
`LoadingContext.tsx`
```tsx
export const useLoading = () => {
  const context = useContext(LoadingContext);
  
  if (!context)
    throw new Error("useLoading must be used within a LoadingProvider");
  
  return context;
};
```

Bọc context trong `App` để tất cả component trong `App` đều có thể dùng:
```tsx
import { LoadingProvider, useLoading } from "LoadingContext";

function AppContent() {
  const { loading } = useLoading();

  return (
    <>
      {loading && <LoadingPage />}
      <Content />
    </>
  );
}

function App() {
  return (
    <BrowserRouter>
		<LoadingProvider>
			<AppContent />
		</LoadingProvider>
    </BrowserRouter>
  );
}
```

Ở đây, tôi cũng đã lấy ra biến `loading` từ context và áp dụng ngay. Nếu `loading` là `true` thì sẽ render component `LoadingPage`, không thì thôi.

# Zustand

## Giới thiệu

**Zustand** là một thư viện global state management nhẹ (*< 1KB*), hiệu năng cao, cú pháp đơn giản.

Cài đặt:
```sh
npm install zustand
```

Trong Zustand, kho lưu trữ được gọi là **store**. Mỗi store gồm có:
- `state`: Là thuộc tính đại diện cho các biến của store, `state.urVar`.
- `set(state)`: Là hàm cập nhật `state`.

## Cách triển khai

1. **Khai báo store**: Tạo store bằng `create((state) => {...})`. Export store này.
2. **Sử dụng store**: Import store và lấy ra các thành phần cần dùng bằng `urStore((state) => urMember)`.

VD:

Khai báo store:

```ts
import { create } from 'zustand';

interface CounterState {
  count: number;
  increase: () => void;
  reset: () => void;
}

const useCounterStore = create<CounterState>((set) => ({
  count: 0,
  increase: () => set((state) => ({ count: state.count + 1 })),
  reset: () => set({ count: 0 }),
}));

export default useCounterStore;
```

Sử dụng store:

```ts
import useCounterStore from 'counterStore';

const HomePage: React.FC = () => {
  const count = useCounterStore((state) => state.count);
  const increase = useCounterStore((state) => state.increase);
  const reset = useCounterStore((state) => state.reset);
  
  // or const { count, increase, reset } = useCounterStore();

  return (
    <div>
      <h1>Giá trị đếm: {count}</h1>
      <button onClick={increase}>Tăng</button>
      <button onClick={reset}>Đặt lại</button>
    </div>
  );
};
```















