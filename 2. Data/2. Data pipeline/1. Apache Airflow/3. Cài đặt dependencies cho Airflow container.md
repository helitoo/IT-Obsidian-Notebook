
Khi dùng Airflow bằng Docker container, khi import các module ngoài (như `sklearn`) thì cần phải sửa lại image, vì các module này chưa có trong container.

# Cách 1: Mở rộng image hiện có

\[Khuyến khích dùng cách này vì tính đơn giản, nhanh chóng của nó]

**1 - Khai báo các module cần thiết cho `requirements.txt`**.

**2 - Tạo mới `Dockerfile`**:
`Dockerfile`
```Dockerfile
FROM apache/airflow:3.1.6

COPY requirements.txt /requirements.txt

RUN pip install --user --upgradge pip
RUN pip install --no--cache-dir --user -r /requirements.txt
```

**3 - Build lại image** và đổi tên cho nó thành `customizing_airflow` với phiên bản là `latest`:
```sh
docker build . --tag customizing_airflow:latest
```

**4 - Sửa lại tên image** trong `docker-compose.yaml`:
```yaml
image: ${AIRFLOW_IMAGE_NAME:-customizing_airflow:latest}
```
Tên mặc định là `${AIRFLOW_IMAGE_NAME:-apache/airflow:3.1.6}`.

**5 - Build lại container**: Chỉ restart các image `airflow-webserver` và `airflow-scheduler`:
```sh
docker compose up --build --no-deps airflow-webserver airflow-scheduler
```

# Cách 2: Tạo image mới

**1 - Clone repository của Airflow**:
```sh
git clone https://github.com/apache/airflow.git
```

**2 - Tạo `requirements.txt`** tại `docker-context-files/`.

**3 - Build image từ source code này**.
```sh
docker build . --build-arg AIRFLOW_VERSION='3.1.6' --tag customizing_airflow:latest
```

**4 - Sửa lại tên image** trong `docker-compose.yaml`:
```yaml
image: ${AIRFLOW_IMAGE_NAME:-customizing_airflow:latest}
```
Tên mặc định là `${AIRFLOW_IMAGE_NAME:-apache/airflow:3.1.6}`.

**5 - Build lại container**: Chỉ restart các image `airflow-webserver` và `airflow-scheduler`:
```sh
docker compose up --build --no-deps airflow-webserver airflow-scheduler
```














