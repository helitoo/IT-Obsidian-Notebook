
\[Hướng dẫn bằng Oracle]

# Quản lý người dùng

**User** là một thực thể người dùng ở database, có thể thao tác lên database (đăng nhập, thêm, sửa, xóa,...). Trong Oracle, 1 user được xem là 1 schema.

User nghiệp vụ (end-user) muốn vào database thì phải thông qua user database.
- Nhiều end-user có thể thông qua 1 database user để vào database.
- Database user thường được phân thành end-user, dev-user,...

**Tạo user**:
```sql
CREATE USER user1
IDENTIFIED BY password123  -- Đặt password
DEFAULT TABLESPACE users   -- Đặt tên TABLESPACE
TEMPORARY TABLESPACE temp  -- Đặt tên TEMPORARY TBS
QUOTA 50M                  -- Giới hạn QUOTA
ON users;  
```

Trong đó:
- `IDENTIFIED`: Mật khẩu.
- `TABLESPACE`: Là vùng lưu trữ dữ liệu logic trong database (ltable, view,...), không phải dữ liệu thật. Được ánh xạ thành 1 hoặc nhiều file `.dbf` vật lý.
- `TEMPORARY TABLESPACE`: Là vùng nhớ trung gian của Oracle để phục vụ cho database engine (`SELECT`, `GROUP`, ...).

Các từ khóa đặc biệt:
- `PUBLIC`: Đại diện cho tất cả user.
- `UNLIMITED`: Đại diện cho lượng `QUOTA` vô giới hạn.

Sau khi tạo user, chưa đăng nhập được mà phải cấp quyền (`GRANT`).

**Sửa user**:
```sql
-- Đổi password
ALTER USER user1 IDENTIFIED BY newPass;

-- Khóa user
ALTER USER user1 ACCOUNT LOCK;

-- Mở khóa user
ALTER USER user1 ACCOUNT UNLOCK;

-- Đổi table space
ALTER USER user1 DEFAULT TABLESPACE data_ts;

-- Đổi quota
ALTER USER user1 QUOTA 100M ON users;
```

**Xóa user**:
```sql
-- Chỉ xóa user
DROP USER user1;

-- Xóa user và dữ liệu
DROP USER user1 CASCADE;
```

**Xem danh sách user**:
```sql
SELECT username, account_status
FROM dba_users;
```

**Xem quyền của user**:
```sql
SELECT * FROM USER_SYS_PRIVS` WHERE grantee = 'USER1';
-- Tương tự với USER_TAB_PRIVS và USER_ROLE_PRIVS
```

# Cấp (`GRANT`) & thu hồi (`REVOKE`) quyền

Các quyền được chia thành 2 nhóm:

**System privileges**: Các quyền hệ thống và định nghĩa dữ liệu:

| Quyền              | Ý nghĩa                |
| ------------------ | ---------------------- |
| `CREATE SESSION`   | Được đăng nhập         |
| `CREATE TABLE`     | Được tạo bảng          |
| `CREATE VIEW`      | Được tạo  view         |
| `CREATE SEQUENCE`  | Được tạo  sequence     |
| `CREATE PROCEDURE` | Được tạo  procedure    |
| `CREATE USER`      | Được tạo  user         |
| `DROP USER`        | Xóa user               |
| `ALTER SYSTEM`     | Được quản trị hệ thống |
| `DBA`              | Được toàn quyền        |

**Object privileges**: Các quyền chỉnh sửa dữ liệu:

|Đối tượng|Quyền|
|---|---|
|TABLE / VIEW|`SELECT`, `INSERT`, `UPDATE`, `DELETE`|
|TABLE|`REFERENCES`|
|SEQUENCE|`SELECT`, `ALTER`|
|PROCEDURE|`EXECUTE`|

**Các cú pháp đặc biệt**:
- `PUBLIC`: Đại diện cho tất cả user.
- `ALL`: Đại diện cho tất cả quyền.
- `SELECT * FROM USER_SYS_PRIVS`: Xem các quyền hệ thống.
- `SELECT * FROM USER_TAB_PRIVS`: Xem các quyền đối tượng.
- `SELECT * FROM USER_ROLE_PRIVS`: Xem các role.

VD: Quyền hệ thống:
```sql
-- Cấp quyền đăng nhập và tạo bảng cho user1
GRANT CREATE SESSION, CREATE TABLE TO user1;

-- Thu lại quyền tạo bảng
REVOKE CREATE TABLE FROM user1;
```

VD: Quyền đối tượng:
```sql
-- Cấp quyền SELECT và INSERT lên hr.employees cho user1
GRANT SELECT, INSERT
ON hr.employees
TO user1;
```

VD: Cấp quyền phân tầng:
```sql
-- Cấp quyền cho user1 và user1 có thể cấp quyền cho user khác
GRANT SELECT
ON hr.employees
TO user1
WITH GRANT OPTION;
```

VD: Gôm nhóm quyền (`ROLE`):
```sql
CREATE ROLE dev_role;

GRANT CREATE TABLE, CREATE VIEW TO dev_role;
GRANT SELECT, INSERT ON hr.employees TO dev_role;

-- Gán các quyền của ROLE dev_role cho user1
GRANT dev_role TO user1;
```

