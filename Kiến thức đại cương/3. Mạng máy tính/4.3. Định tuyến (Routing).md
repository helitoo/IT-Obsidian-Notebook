
```insta-toc
---
title:
  name: Mục lục
  level: 1
  center: false
exclude: ""
style:
  listType: number
omit: []
levels:
  min: 1
  max: 6
---

# Mục lục

1. Các dịch vụ vận chuyển
2. Mạch ảo và Mạch gói tin
3. Các thuật toán định tuyến
    1. Phân loại thuật toán định tuyến
4. Định tuyến trong Internet
    1. Phân cấp định tuyến
    2. Một số giao thức nội miền
    3. Giao thức liên miền BGP
    4. Định tuyến bằng phần mềm SDN (Software defined networking)
    5. Các giao thức quản lý mạng
```

# Các dịch vụ vận chuyển

Network layer cung cấp dịch vụ truyền gói tin từ máy gửi đến máy nhận. Tùy vào kiến trúc mạng mà có các mô hình dịch vụ khác nhau.

Có 2 loại mô hình:
1. **Dịch vụ theo từng gói tin riêng lẻ**:
	- Đảm bảo truyền gói tin đến đích.
	- Độ trễ thấp.

2. **Dịch vụ theo từng luồng gói tin**:
	- Truyền theo thứ tự.
	- Đảm bảo băng thông tối thiểu cho luồng.
	- Hạn chế dao động khoảng cách giữa các gói.

Một số loại dịch vụ:

| Kiến trúc mạng                        | Mô hình dịch vụ               | Băng thông      | Mất gói | Thứ tự | Thời gian |
| ------------------------------------- | ----------------------------- | --------------- | ------- | ------ | --------- |
| **Internet** (mặc định, truyền thống) | Best efford - Tốt nhất có thể | --              | --      | --     | --        |
| **ATM**                               | Tốc độ không đổi              | Tỷ lệ không đổi | Có      | Có     | Có        |
| **ATM**                               | Tốc độ khả dụng               | Tối thiểu       | --      | Có     | --        |
| **Internet (RFC 1633)**               | Đảm bảo                       | Có              | Có      | Có     | Có        |
| **Internet (RFC 2475)**               | Phân tán                      | Có thể          | Có thể  | Có thể | Có        |

# Mạch ảo và Mạch gói tin

Mạch ảo và Mạch gói tin là 2 phương pháp kết nối logic giữa máy gửi và nhận, không phải [[1. Tổng quan về mạng máy tính#Chuyển mạch kênh (Circuit switching)|Chuyển mạch kênh (Circuit switching)]].

| Đặc điểm                       | Mạch ảo (Virtual circuit)          | Mạch gói tin (Datagram circuit) |
| ------------------------------ | ---------------------------------- | ------------------------------- |
| **Dịch vụ kết nối**            | Hướng kết nối.                     | Phi kết nối.                    |
| **Thiết lập trước khi truyền** | Có.                                | --                              |
| **Forward dựa trên**           | VC number (ngắn gọn hơn)           | Địa chỉ IP đích                 |
| **Trạng thái trong router**    | Phải lưu trạng thái VC             | Không lưu trạng thái kết nối    |
| **Cấp phát tài nguyên**        | Có thể cấp phát băng thông, buffer | Không đảm bảo, nỗ lực tốt nhất  |
| **Thứ tự gói tin**             | Đảm bảo đúng thứ tự                | Có thể sai thứ tự               |
| **VD**                         | ATM, X.25, Frame Relay             | Internet (IP)                   |

Tại sao Internet chọn mô hình Datagram, còn ATM chọn Virtual Circuit?
1. **Internet**:
	- Dữ liệu giữa máy tính có thể chịu trễ, mất gói, tỷ lệ trễ, mất gói thấp.
	- Mạng bên trong đơn giản, thông minh nằm ở thiết bị đầu cuối (PC có thể xử lý lỗi, TCP đảm bảo).
	- Hạ tầng đa dạng (nhiều loại link), khó đồng nhất dịch vụ.

2. **ATM**:
	- Cần phục vụ thoại / video thời gian thực.
	- Cần đảm bảo băng thông, trễ thấp, độ tin cậy cao.
	- Điện thoại/thiết bị đầu cuối kém thông minh → mạng phải gánh trách nhiệm phức tạp.

# Các thuật toán định tuyến

## Phân loại thuật toán định tuyến

Các khái niệm:
- **Chi phí truyền tin từ node A đến node B**: Do ISP xác định.
- **Metric**: Là đại lượng đo chi phí của tuyến đường.
- **Hop**: Đơn vị chi phí của metric.
- **Advertisement**: Là gửi thông tin cấu trúc liên kết của mạng cho các router. Cả LS và DV đều dùng.

Phân loại dựa trên *cách các router được cung cấp thông tin về cấu trúc liên kết của mạng*:
1. **Định tuyến toàn cầu (Link State - LS)**:
	- Tất cả router đều biết cấu trúc liên kết của *toàn bộ mạng* qua *broadcast*.
	- Mỗi router dựa vào thông tin này để tính toán đường đi tối ưu.

2. **Định tuyến phi tập trung (Distance Vector - DV)**:
	- Mỗi router ban đầu chỉ biết chi phí đến các *router hàng xóm*.
	- Quá trình định tuyến diễn ra theo cách lặp đi lặp lại, khi các router trao đổi thông tin với hàng xóm để dần dần tìm ra đường đi tối ưu.

Phân loại dựa trên *cách thức định tuyến*:
1. **Định tuyến động**:
	- Đường đi có thể linh hoạt thay đổi khi chi phí liên kết thay đổi.
	- Thông tin được cập nhật định kỳ hoặc ngay khi có sự thay đổi trong mạng.

2. **Định tuyến tĩnh**:
	- Do con người tự cấu hình các tuyến đường.
	- Các đường đi ít thay đổi, thay đổi chậm.

**Một số thuật toán định tuyến**:

|                    | Dijkstra's link-state                                                                                                                                                                                                                                                                                                                                                                                                                                                             | Distance vector routing                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| ------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Nền tảng**       | Link state - Các router biết được cấu trúc mạng nhờ vào việc các router đều phát thông tin trạng thái liên kết cho mình cho toàn mạng biết qua các gói tin **link state broadcast**.<br><br>-> Nếu **mạng quá lớn thì gây tốn tài nguyên**.                                                                                                                                                                                                                                       | Distance vector - Các router biết chi phí đến mọi router dựa vào các router hàng xóm.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| **Thuật toán**     | **1. Khởi tạo**:<br>- Gọi $N$ là tập hợp các router mà từ router xuất phát $u$ đến mọi router trong $N$ đều là ngắn nhất. Ban đầu, $N = \{ u \}$.<br>- Kiểm tra các router $v$ của mạng, nếu $v$ là hàng xóm của $u$ thì $d(v) = c(u, v)$, không thì $d(v) = \infty$.<br><br>**2. Lặp**: Kiểm tra các router trong $N$:<br>- Chọn router $w \in N$ sao cho $d(w)$ nhỏ nhất.<br>- Thêm $w$ vào $N$.<br>- Với tất cả router $v$ là hàng xóm của $w$, $d(v) = \min(d(w) + c(w, v))$. | - Mỗi router duy trì một vector ước tính khoảng cách đến mọi router khác.<br>- Nếu vector khoảng cách của 1 router thay đổi, router đó sẽ gửi vector của mình cho láng giềng.<br><br>- Khi một router nhận được vector từ router khác, nó **tự cập nhật vector của mình bằng công thức Bellman-Ford**.<br>$$ d(x, z) = \min\{ c(x, y) + d(y, z) \} $$<br>Trong đó: $y$: Hàng xóm của $x$.<br><br>- Ban đầu, mỗi router chỉ biết khoảng cách đến hàng xóm của nó. Càng về sau, nó sẽ biết lan ra các router xung quanh (**hội tụ**). Thời gian hội tụ phụ thuộc vào số lượng lần trao đổi thông tin và cấu trúc mạng. |
| **Hiện tượng lỗi** | **Hiện tượng dao động định tuyến (Routing oscillation)**:<br><br>- Xảy ra khi **chi phí phụ thuộc vào lưu lượng**. Khi lưu lượng thay đổi, chi phí thay đổi, thuật toán cần được chạy lại từ đầu.<br><br>- Giải pháp:<br>+ Xây dựng chi phí phụ thuộc vào băng thông.<br>+ **Poison reverse**: Giới hạn mức trần của metric, không cho cập nhật $d$ nếu vượt ngưỡng trần.                                                                                                         | **Hiện tượng tin xấu lan truyền chậm (Count to infinity) / Vòng lặp định tuyến (Routing loop)**:<br>- Xảy ra khi xuất hiện **liên kết tăng chi phí đột ngột** (như mất liên kết).<br>- Nhưng tin này truyền đi quá chậm, khiến các router nhầm tưởng rằng liên kết đó vẫn bình thường, dẫn đến lặp đi lặp lại truyền gói.<br>                                                                                                                                                                                                                                                                                        |
|                    | Nếu có một router lỗi, **các router khác vẫn hoạt động bình thường** vì nó biết chi phí toàn cục và tính toán cục bộ.                                                                                                                                                                                                                                                                                                                                                             | Nếu có một router lỗi, **các router khác sẽ bị ảnh hưởng** vì mỗi router đều giao tiếp với nhau để tính toán chi phí.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |

# Định tuyến trong Internet

## Phân cấp định tuyến

Quy mô Internet hiện nay có hàng tỷ router, không thể lưu trữ tất cả router trong bảng định tuyến.
-> Internet được chia thành nhiều **mạng con tự trị** (AS, Autonomous System), mỗi AS có:
- **Quản trị viên** riêng, có toàn quyền định tuyến trong phạm vi mạng.
- **Router cổng (Gateway router)**: Nằm ở rìa AS, vừa định tuyến các router trong AS (nội miền), vừa định tuyến giữa các AS (liên miền).
- AS là cấp độ mạng ở góc nhìn kỹ thuật định tuyến. AS có thể được chia thành nhiều [[#Mạng con (Subnet)]].

Có 2 loại AS:

|                        | Intra-AS (Nội miền)                                                                                                                                 | Inter-AS (Liên miền)                                                                        |
| ---------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------- |
| **Mô tả**              | - Tất cả router trong cùng một AS phải chạy **cùng một giao thức nội miền**.<br><br>- Các AS khác nhau có thể sử dụng giao thức nội miền khác nhau. | Gồm các AS được liên kết quả router cổng (Gateway router).                                  |
| **Chính sách quản lý** | 1 quản trị viên, ít vấn đề về chính sách.<br><br>-> Nên tập trung vào hiệu suất.                                                                    | Cần kiểm soát cách lưu lượng ra/vào các AS.<br><br>-> Nên tập trung vào chính sách quản lý. |
| **Quy mô**             | Nhỏ.<br>Ít lo về kích thước bảng.                                                                                                                   | Lớn.<br>Cần phân cấp thành các AS nhằm giảm kích thước bảng và lưu lượng cập nhật.          |

**Bảng chuyển tiếp** trong router được xác định nhờ:
- **Giao thức nội miền**: Xử lý các đích nằm trong AS.
- **Giao thức liên miền**: Xử lý các đích bên ngoài.

## Một số giao thức nội miền

1. **OSPF (Open shortest path first)**:
	- Dựa trên LS (Dijkstra).
	- OSPF có thể được phân cấp thành nhiều vùng mạng con, các router chỉ biết cấu trúc trong một phạm vi mạng (**area cục bộ**). Các area cục bộ được liên kết với **backbone area** để trao đổi thông tin mạng.
	- Chạy trực tiếp trên IP, không dùng [[3. Transport layer#Giao thức TCP / UDP|TCP/IP]].
	- Metric được đo tổng hợp bằng nhiều yếu tố như băng thông, độ trễ,...

2. **RIP (Routing information protocol)** \[Cổ điển]:
	- Dựa trên DV (Bellman-Ford).
	- Metric được đo bằng hop (*chi phí được tính dựa vào số lượng router đi qua*).
	- Advertisement được trao đổi giữa các router mỗi 30s, truyền tối đa 25 hop, phạm vi tối đa 25 subnet.
	- **Cách xử lý routing loop**: Nếu có router không nhận advertisement trong 180s thì coi như kết nối gian đoạn, bỏ qua quãng đường đó. Kết hợp với *posion reverse*: Mỗi advertisement chỉ truyền trong 18 hop.

 3. **EIGRP (Enhanced interior gateway routing protocol)**:
	- Dựa trên DV.
	- Metric được đo tổng hợp nhiều yếu tố.

## Giao thức liên miền BGP

**BGP (Border Gateway Protocol):** Giao thức liên miền chủ đạo, được coi là "*chất keo kết nối Internet*".

Chức năng:
- Cho phép mạng con thực hiện advertisement và tiếp cận với phần còn lại Internet.
- Thông tin được trao đổi qua:
	1. **eBGP:** Giữa các AS với nhau.
	2. **iBGP:** Bên trong một AS để lan truyền thông tin từ router cổng đến toàn bộ router trong AS.        
- Lựa chọn tuyến tốt không chỉ dựa trên hiệu suất, mà còn phụ thuộc vào **chính sách quản trị**.

## Định tuyến bằng phần mềm SDN (Software defined networking)

Đặc điểm:
1. **Mức điều khiển tập trung**:
	- Bộ điều khiển SDN quản lý toàn bộ mạng.
	- Router / Switch chỉ đơn giản chuyển tiếp bảng forward do bộ điều khiển cài đặt.
	- Dễ quản lý, tránh lỗi cấu hình, linh hoạt hơn.

2. **Giao diện OpenFlow**:
	- Cho phép bộ điều khiển cài đặt / sửa đổi bảng chuyển tiếp trong switch.
	- Có 3 loại thông điệp chính:
		1. Từ bộ điều khiển đến switch (cấu hình, trạng thái, packet-out).
		2. Từ switch đến bộ điều khiển (packet-in, thông báo trạng thái).
		3. Thông điệp đối xứng.

Lợi ích:
1. Cho phép "lập trình mạng" ở mức cao.
2. Mở ra khả năng đổi mới nhanh, giống như máy tính từ thời “mainframe” sang “PC”.

## Các giao thức quản lý mạng

1. **SNMP (Simple Network Management Protocol)**:
    - Cho phép lấy dữ liệu từ thiết bị (get), đặt cấu hình (set), và nhận cảnh báo (trap).
    - Dữ liệu quản lý được tổ chức trong **MIB (Management Information Base)**.
	
2. **NETCONF/YANG**:
    - **NETCONF**: Giao thức quản lý thiết bị ở mức cao hơn, dựa trên RPC, mã hóa XML, truyền qua kênh an toàn (TLS).
    - **YANG**: Là ngôn ngữ mô hình hóa dữ liệu quản lý mạng, giúp định nghĩa cấu trúc và ràng buộc dữ liệu.
