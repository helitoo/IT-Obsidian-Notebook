
```insta-toc
---
title:
  name: Mục lục
  level: 1
  center: false
exclude: ""
style:
  listType: number
omit: []
levels:
  min: 1
  max: 6
---

# Mục lục

1. Địa chỉ MAC
2. Giao thức phân giải địa chỉ (ARP, Address resolution protocol)
3. Giao thức Ethernet
4. Switch
5. VLAN (Virtual LAN, LAN ảo)
```

# Địa chỉ MAC

**Địa chỉ MAC / LAN / vật lý / Ethernet**... là địa chỉ cục bộ để chuyển frame từ một cộng vật lý này sang một cổng khác có kết nối vật lý với nó (cùng mạng IP).

Ký hiệu:
- `FF-FF-FF-FF-FF-FF` hoặc
- `FFFF.FFFF.FFFF`.

Địa chỉ MAC dài **48 bits**, bao gồm:
- 24 bit: Không gian địa chỉ của nhà sản xuất.
- 24 bit: Địa chỉ định danh thiết bị.

MAC là địa chỉ **độc nhất** trên toàn mạng, được **ghi thẳng vào card mạng** (NIC). Địa chỉ MAC được quản lý bởi IEEE.

Địa chỉ MAC *có thể* được sửa đổi bằng phần mềm.

# Giao thức phân giải địa chỉ (ARP, Address resolution protocol)

Mỗi node đều lưu một **bảng ARP** chứa **địa chỉ MAC, địa chỉ IP và TTL**.

Khi A muốn gửi frame tới B:
- A tra cứu bảng ARP của mình.
- Nếu bảng ARP của A chứa địa chỉ MAC của B thì cứ gửi.
- Nếu không, A gửi **gói ARP** vào **broadcast**, gói này chứa **source MAC, source IP, dest IP**. Khi một node nào đó nhận được gói ARP và thấy dest IP chính là IP của mình thì node đó sẽ gửi IP của mình cho A. A cập nhật bảng ARP, quay lại bước đầu.

>[!important]
>Trong quá trình gửi gói tin qua các nút, địa chỉ MAC được ghi nhận là **địa chỉ của 2 nút liên tiếp**, tức là mỗi lần gói tin qua mỗi nút thì MAC sẽ thay đổi, còn IP giữ nguyên.

# Giao thức Ethernet

Một số đặc điểm của Ethernet:
- **Không kết nối:** Không handshaking.
- **Không tin cậy**: Không có ACK, NACK.
- Giao thức đa truy cập: Uslotted.

Các cấu trúc liên kết vật lý của Ethernet:
- **Bus (cáp đồng trục)**: 
- **Chuyển mạch (Switch)** \[Hiện đại]: Dùng switch làm trung gian cho các kết nối, mỗi nút gửi frame cho switch trước rồi switch gửi gói tin đó cho nút đích -> Chỉ có xung đột khi các kết nối có cùng đích.

**Cấu trúc Ethernet frame**:
- **Trường mở đầu (Preamble)**: Đồng bộ hóa xung đồ hồ nút nhận và nút gửi.
- **Dest MAC**, **Source MAC**.
- **CRC**.
- Kiểu dữ liệu.
- Dữ liệu.

Có nhiều dạng Ethernet khác nhau về tốc độ và loại đường truyền, nhưng nguyên lý thì tương tự.

# Switch

**Switch** là thiết bị ở link layer:
- Nằm ở vị trí *trung gian* trên đường truyền giữa các host và switch khác, mỗi cổng của switch ứng với 1 host. Trong switch cũng có **bảng chuyển tiếp** để định vị các cổng và host tương ứng.
- Có vai trò lưu trữ, chuyển tiếp frame có chọn lọc.
- Mỗi liên kết được chạy một giao thức Ethernet riêng, chỉ có xung đột khi các kết nối có cùng đích.

Đặc điểm:
- **Trong suốt**: Switch vô hình trong mắt server.
- **Plug-and-play (Tự học)**:
	- Switch không cần phải cấu hình, cắm là chạy.
	- Khi switch nhận gói tin đến -> Nó biết MAC nguồn của host gửi -> Ghi MAC và số cổng vào bảng chuyển tiếp.
	- Khi switch gửi gói tin, nó *tra cứu bảng chuyển tiếp* trước. Nếu không tìm thấy MAC đích thì sẽ gửi gói đó ra *toàn bộ cổng* ngoài trừ cổng nguồn. Nếu gói tin đó gửi đến host không phải đích (*so sánh MAC*) thì gói tin sẽ bị hủy ở ngay link layer.

**So sánh switch với router**:
- **Router**: Hoạt động ở network layer, có thuật toán định tuyến được cài đặt trước.
- **Switch**: Hoạt động ở link layer, tự học và tự xây dựng bảng định tuyến.

# VLAN (Virtual LAN, LAN ảo)

Vấn đề khi LAN quá lớn:
- Cần rất nhiều broadcast.
- Xuất hiện vấn đề bảo mật.
- Xuất hiện vấn đề quản trị khi thay đổi số cổng của host.

**VLAN** là các mạng ảo được cấu hình bởi phần mềm switch thì một mạng LAN thật (LAN vật lý). Nói cách khác, 1 switch có thể có nhiều mạng LAN con (VLAN).

Mỗi VLAN được gắn 1 **VLAN ID** để định danh. VLAN ID được gắn vào ethernet frame (chuẩn `208.1q`).

**Lợi ích:**
- **Cách ly lưu lượng**: Các mạng VLAN con chỉ được dùng một số cổng vật lý của switch.
- **Thành viên động**: Các host có thể được thay đổi cổng.
- **Trunk port**: Là kết nối giữa 2 switch.
