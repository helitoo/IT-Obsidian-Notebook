
Docker compose là công cụ giúp xây dựng nhiều container cùng lúc.

Docker compose được cấu hình trong file `docker-compose.yml`.

# Một số trường của `docker-compose.yml`

| Trường     | Ý nghĩa                                                                          |
| ---------- | -------------------------------------------------------------------------------- |
| `version`  | Số phiên bản.                                                                    |
| `services` | Tên container.                                                                   |
| `volumes`  | Khai báo thư mục dùng để lưu dữ liệu. Nếu không khai báo thì Docker sẽ ngầm tạo. |
| `networks` | Cấu hình network cho ứng dụng.                                                   |

Bên trong trường `services` có một số trường con sau:

| Trường       | Ý nghĩa                                                                                                                         |
| ------------ | ------------------------------------------------------------------------------------------------------------------------------- |
| `image`      | Tên image sẽ được dùng để build container.                                                                                      |
| `port`       | Có dạng `a:b`, với:<br>- `a` là port của máy thật.<br>- `b` là port của container.                                              |
| `volumes`    | Có dạng `a:b`, với:<br>- `a` là đường dẫn của máy thật, là tên volumns đã khai báo ở trên.<br>- `b` là đường dẫn của container. |
| `enviroment` | Các biến môi trường được truyền vào Docker.                                                                                     |
| `depends_on` | Chọn các service được thực thi trước khi thực thi service này.                                                                  |
| `build`      | Chỉ ra vị trị đường dẫn đặt `Dockerfile`                                                                                        |

VD:
```yaml
version: "3.9"

services:
  api:
    image: python:3.11
    container_name: api
    working_dir: /app
    volumes:
      - ./app:/app
    command: python main.py
    ports:
      - "8000:8000"
    environment:
      DATABASE_URL: postgresql://admin:admin@db:5432/demo
      REDIS_HOST: redis
    depends_on:
      - db
      - redis

  db:
    image: postgres:15
    container_name: postgres
    environment:
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: admin
      POSTGRES_DB: demo
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

  redis:
    image: redis:7
    container_name: redis
    ports:
      - "6379:6379"

volumes:
  postgres_data:
```

# Các câu lệnh thường dùng

Build các images (nếu cần tạo):
```sh
docker-compose build
```

Chạy các services bên trong background:
```sh
docker-compose up -d
```

Chạy container và build image
```sh
docker-compose up --build -d
```

Dừng và loại bỏ các container, network, image và volume:
```sh
docker-compose down
```



