
```insta-toc
---
title:
  name: Mục lục
  level: 1
  center: false
exclude: ""
style:
  listType: number
omit: []
levels:
  min: 1
  max: 6
---

# Mục lục

1. Partitioning
2. Virtual address - Physical address mapping
3. Effective access time
4. Virtual memory
```


# Partitioning

Cho bộ nhớ được phân chia thành các vùng cố định như sau:
1. 250 KB.
2. 300 KB.
3. 100 KB.
4. 400 KB.
5. 300 KB.

**Nếu con trỏ đang ở vùng nhớ 2 và các vùng nhớ khác vẫn đang trống thì process cần 160 KB sẽ được cấp vào vùng nhớ nào theo cơ chế next-fit?**

Vùng nhớ 4 (*Next-fit*: Chọn vùng nhớ phù hợp tiếp theo).

# Virtual address - Physical address mapping


>[!note] Bảng quy đổi các đơn vị cơ bản
>- 1 B = $8$ bits.
>- 1 KB = $2^{10}$ B.
>- 1 MB = $2^{20}$ B.
>- 1 GB = $2^{30}$ B.
>- 1 TB = $2^{40}$ B.

---
**Địa chỉ vật lý `4100` tương ứng với địa chỉ ảo là mấy? Biết kích thước frame là 1 KB và có page table như sau:**

| Page number | Frame number |
| ----------- | ------------ |
| 0           | 6            |
| 1           | 4            |
| 2           | 5            |
| 3           | 7            |
| 4           | 1            |
| 5           | 9            |

- Ta có 1 KB = $2^{10}$ B, nên page offset = $10$ bit.
- Địa chỉ vật lý `4100` = `000100 0000000100`, với frame number `000100` = `4`, ứng với page number `1` = `1`.
- Vậy địa chỉ ảo là `1 0000000100` = `1028`.

---
**Cho không gian logic 32 bits, kích thước 1 page = 4 KB. Hỏi page table có mấy entries?**

Ta có:
- Kích thức bộ nhớ logic: $m=32$.
- Kích thước 1 page: $4.2^{10}=2^m\Rightarrow m=12$.
- Vậy số entries: $2^{m-n}=2^{32-12}=2^{20}$.

---
Một máy tính có không gian ảo 32 bit sử dụng phân trang 3 cấp:
- Cấp 1: 4 bit.
- Cấp 2: 4 bit.
- Cấp 3: 8 bit.
**Địa chỉ `0xAADDCBAD` có offset là?**

Chỉ cần loại bỏ 16 bit đầu là ra, đáp án `0xCBAD`.

>[!note]
>`0x` là ký hiệu hệ 16 phân.

# Effective access time

Cho:
- Bảng TLBs với hit ratio $h=90\%$.
- Thời gian tra cứu TLBs $t_{lookup}=20$ (ns).
- Thời gian truy xuất hiệu dụng: $\text{EAT}=240$ (ns).

**Nếu $h'=85\%$ thì thời gian truy xuất $\text{EAT}'$ là?**

Khi $h=90\%$:
$$
\begin{align}
\text{EAT}&=h(t_{lookup}+t_{access})+(1-h)(t_{lookup}+2.t_{access})\\
\Rightarrow t_{access}&=200\tag{ns}
\end{align}
$$

Vậy:
$$
\begin{align}
\text{EAT}'&=h'(t_{lookup}+t_{access})+(1-h')(t_{lookup}+2.t_{access})\\
&=250\tag{ns}
\end{align}
$$

# Virtual memory

1 process có 4 frame và 8 page, khi được nào thì các frame đang trống. Process này đã truy xuất 8 page (có STT từ `1` đến `8`) theo thứ tự như sau:
```
1 3 2 7 3 6 2 8 5 1 3 7 6 4 6 2 2 5 1 4
```
Minh họa các giải thuật thay trang FIFO, LRU, OPT.

>[!note] Hướng dẫn làm bài
>- 1 process có $n$ trang, mỗi trang có $m$ page thì sẽ tạo thành bảng $n\times m$.
>- Ban đầu, các frame có thể trống hoặc đã được nạp trước 1 số page rồi. Sau đó, bạn cứ dò theo thứ tự nạp page và nguyên lý thuật toán để điền page number phù hợp vào các frame.

**FIFO**: Thay ô được **TÔ ĐỎ sớm nhất**.

![](paging-fifo.png)

**LRU**: Thay ô được **TÔ MÀU sớm nhất**.

![](paging-lru.png)


**OPT**: Thay **Ô DỰ ĐỊNH NẠP xa nhất**.

![](paging-opt.png)


















