
```insta-toc
---
title:
  name: Mục lục
  level: 1
  center: false
exclude: ""
style:
  listType: number
omit: []
levels:
  min: 1
  max: 6
---

# Mục lục

1. Tổng quan
    1. Deadblock
    2. Trạng thái an toàn của hệ thống
    3. Điều kiện xảy ra deadblock
    4. Các phương pháp giải quyết deadlock
2. Mô hình hóa bài toán tắc nghẽn
    1. Đồ thị cấp phát resource (Resource allocation graph, RAG) và wait-for graph
    2. Giải thuật Banker
```

# Tổng quan

## Deadblock

**Deadblock** là hiện tượng có một tập các process bị block, mỗi process giữ một số resource và đang chờ thêm các resource khác mà các process khác trong tập đang giữ. Sự tắc nghẽn có thể diễn ra **vô hạn**.

## Trạng thái an toàn của hệ thống

Hệ thống an toàn khi **có ít nhất 1 chuỗi an toàn**.

**Chuỗi an toàn**: Là thứ tự thực thi các process sao cho không xảy ra deadblock.

## Điều kiện xảy ra deadblock

1. **Loại trừ tương hỗ (Mutual exclusion)**: Có resource nào đó được giữ theo **non-sharable mode** (không được dùng bởi nhiều process).
2. **Giữ và chờ cấp thêm resource (Hold & Wait)**:
	- Một process đang giữ ít nhất 1 resource và đợi thêm resource do process khác giữ.
	- Các process nắm resource mà các process khác đang cần, tạo ra một **chu trình đợi**.
3. **Không trưng dụng (Non-preemptive)**: Resources chỉ có thể được **hoàn trả** bởi process đang giữ nó.  OS không thể cưỡng ép thu hồi.

## Các phương pháp giải quyết deadlock

1. **Ngăn deadblock**: Ngăn **(ít nhất)** một trong 4 điều kiện xảy ra deadlock:
	1. **Ngăn Hold & Wait**: Block process nếu không thể cấp phát.
	2. **Ngăn Preemption**: Thu hồi resources của process.
	3. **Ngăn chu trình đợi**: Đánh số thứ tự cho các resources.
	-> Không thể ngăn hoặc không cần ngăn **mutual exclusion**.
	-> Không cần biết resources tối đa mà process muốn.
	-> Không đảm bảo hiệu suất sử dụng resources.

2. **Tránh deadblock**:
	- Các process cần **cung cấp thông tin về resource nó cần và tình trạng allocation** để OS dự đoán khả năng có deadblock.
	-> Đảm bảo hệ thống không đi đến trạng thái không an toàn.
	-> Đảm bảo hiệu suất sử dụng resources.
	VD: *Banker*.

3. **Phát hiện deadblock**:
	- Nếu xảy ra deadblock thì cố gắng giải quyết.
	- VD: *RAG, wait-fot graph*.

4. **Bỏ qua deadblock**: Nếu xảy ra deadblock, OS quá tải và ngưng hoạt động.

# Mô hình hóa bài toán tắc nghẽn

## Đồ thị cấp phát resource (Resource allocation graph, RAG) và wait-for graph

-> Dùng để **Phát hiện deadblock**.

|                         | Resource allocation graph (RAG)                                                                                                                                                                                                                                                                                      | Wait-for graph                                                                                    |
| ----------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------- |
| **Loại đồ thị**         | Có hướng                                                                                                                                                                                                                                                                                                             | Có hướng                                                                                          |
| **Tập đỉnh**            | Có 2 loại là process ($p$) và loại resource ($r$).<br><br>Số lượng process tối đa được quyền nắm giữ 1 resource được gọi là **số lượng instance**. Ký hiệu là chấm `.`.                                                                                                                                              | Chỉ có process ($p$).<br><br>Mỗi resource có 1 instance.                                          |
| **Tập cạnh**            | - Process $P_i$ yêu cầu resource $R_j$: $P_i\rightarrow R_j$.<br><br>- resource $R_j$ đang bị giữ bởi process $P_i$: $R_j\rightarrow P_i$.                                                                                                                                                                           | Process $P_i$ yêu cầu resource của process $P_j$: $P_i\rightarrow P_j$.                           |
| **Nhận biết deadblock** | - *Không* chứa chu trình -> *Không* có deadblock.<br><br>- *Có* chu trình -> **Có thể** có deadblock:<br>	1. Mỗi resource trong chu trình chỉ có 1 thực thể -> Deadblock.<br>	2. Mỗi resource trong chu trình có nhiều thực thể -> Có thể có deadblock. *Số lượng thực thể càng ít thì khả năng deadblock càng cao*. | - *Không* chứa chu trình -> *Không* có deadblock.<br><br>- *Có* chu trình -> **Có** có deadblock. |
| **Độ phức tạp**         | $\boxed{O(p+r+e)}$                                                                                                                                                                                                                                                                                                   | $\boxed{O(p+e)}$                                                                                  |

## Giải thuật Banker

-> Dùng để **Tránh deadblock**.

**Độ phức tạp**: $\boxed{O(r.p^2)}$:
- $r$: Số loại resources.
- $p$: Số process.

Yêu cầu các process phải khai báo $\text{Need}$ là lượng resource tối đa nó cần, OS dựa vào đây để cấp phát.
